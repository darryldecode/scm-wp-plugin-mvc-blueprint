var SCM_BLUEPRINT_NEWS_MODULE = angular.module('SCM_BLUEPRINT_NEWS_MODULE', ['SCM_COMMON_SERVICE_MODULE','ui.bootstrap','ui.tree']);SCM_BLUEPRINT_NEWS_MODULE.directive('onImgErrorSrc', function() {  return {    link: function(scope, element, attrs) {      element.bind('error', function() {        if (attrs.src != attrs.onImgErrorSrc) {          attrs.$set('src', attrs.onImgErrorSrc);        }      });    }  }});SCM_BLUEPRINT_NEWS_MODULE.controller('NewsController', ['$q','$http','$scope','$uibModal','GlobalLoaderService',function($q,$http,$scope,$uibModal,GlobalLoaderService) {    console.log('NewsController Booted');    var newsCtrl = this;    newsCtrl.news = {        init: function() {            // GlobalLoaderService.show("Please select advertiser to fetch data from.","danger").hide();            // GlobalLoaderService.show("Fetching Data from API","info");            //  GlobalLoaderService.show(response.message,"success").hide();                        newsCtrl.news.ajax.getUnionAllCategories(function(success){                                newsCtrl.news.formatters.formatNewsCategoriesFromServer(success.data.data);                //Merge categories to union lists                newsCtrl.news.ajax.getKewordsCategories(function(success) {                    newsCtrl.news.methods.mergeCategoriesToUnionList(success.data.data.data);                    // console.log(newsCtrl.news.data.categoryItems);                },function(error){                    console.log(error);                });            },function(error){                console.log(error);            });            newsCtrl.news.methods.loadAllUnionNews();        },        indicators: {            isListLoading: true,            isPullingDataFromRSS: false        },        inputs: {            selectedCategoryKeywords: '',            selectedNewsItem: {}        },        data: {            paged: 1,            per_page: 20,            totalItems: 0,            items: [],            categoryItems: [],            categoryItemCount: 1        },        ajax: {            getKewordsCategories: function(successCb,errorCb) {                $http({                    url: 'http://unionhub.seospeed.host',                    method: 'GET',                    params: {                        req: 'scmVizsion',                        state: 'FrontCategory',                        action: 'ajaxGetOneCategoryGroup',                        id: 1                    }                }).then(function(success) {                    successCb(success);                }, function(error) {                    errorCb(error);                });            },            getUnionAllCategories: function(successCb,errorCb) {                $http({                    url: SCM_BLUEPRINT_DATA.SCM_BLUEPRINT_API_ENDPOINT+'state=News&action=ajaxGetAllUnionCategories',                    method: 'GET'                }).then(function(success) {                    successCb(success);                },function(error) {                    errorCb(error);                });            },            getUnionAllNews: function(data,successCb,errorCb)            {                newsCtrl.news.indicators.isListLoading = true;                $http({                    url: SCM_BLUEPRINT_DATA.SCM_BLUEPRINT_API_ENDPOINT+'state=News&action=ajaxGetAllUnionNews',                    method: 'GET',                    params: data                }).then(function(success) {                    newsCtrl.news.indicators.isListLoading = false;                    successCb(success);                },function(error) {                    errorCb(error);                    newsCtrl.news.indicators.isListLoading = false;                });            },            fetchNewsFeeds: function(successCb,errorCb) {                if(newsCtrl.news.inputs.selectedCategoryKeywords=='') {                    GlobalLoaderService.show("Please select keywords to fetch data.","danger").hide();                    return false;                }                GlobalLoaderService.show("Fetching Data from RSS","info");                                newsCtrl.news.indicators.isPullingDataFromRSS = true;                $http({                    url: SCM_BLUEPRINT_DATA.SCM_BLUEPRINT_API_ENDPOINT+'state=News&action=ajaxGetFetchNewsFeeds',                    method: 'GET',                    params: {                        news_query: newsCtrl.news.inputs.selectedCategoryKeywords                    }                }).then(function(success) {                    newsCtrl.news.indicators.isPullingDataFromRSS = false;                    GlobalLoaderService.show(success.data.message,"success").hide();                    successCb(success);                },function(error) {                    newsCtrl.news.indicators.isPullingDataFromRSS = false;                    errorCb(error);                });            }        },        buttons: {            fetchData: function () {                                newsCtrl.news.ajax.fetchNewsFeeds(function(success){                    newsCtrl.news.methods.loadAllUnionNews();                },function(error){                    console.log(error);                });            },            pageChanged: function () {                newsCtrl.news.ajax.getUnionAllNews({                    paged: newsCtrl.news.data.paged,                    per_page: newsCtrl.news.data.per_page                },function(success){                    newsCtrl.news.data.paged = success.data.data.paged;                    newsCtrl.news.data.per_page = success.data.data.per_page;                    newsCtrl.news.data.items = success.data.data.items;                    newsCtrl.news.indicators.isListLoading = false;                }, function(error){                    newsCtrl.news.indicators.isListLoading = false;                    GlobalLoaderService.show("Unable to get Union news.","danger").hide();                });            },            view: function (news) {                newsCtrl.news.inputs.selectedNewsItem = news;                var modalInstance = $uibModal.open({                    animation: false,                    ariaLabelledBy: 'modal-title',                    ariaDescribedBy: 'modal-body',                    templateUrl: 'viewNews.html',                    controller: 'ModalInstanceCtrl',                    controllerAs: 'newsCtrl',                    size: 'lg',                    resolve: {                        news: function() {                            return newsCtrl.news.inputs.selectedNewsItem;                        }                    }                });                modalInstance.result.then(function () {                }, function () {                });            }        },        formatters: {            formatNewsCategoriesFromServer: function(categories) {                angular.forEach(categories, function(category) {                    var formattedCategory = {                        id: newsCtrl.news.data.categoryItemCount,                        name: category.post_title,                        value: category.post_title                    }                    newsCtrl.news.data.categoryItems.push(formattedCategory);                    newsCtrl.news.data.categoryItemCount++;                });            }        },        methods: {            mergeCategoriesToUnionList: function (categories) {                angular.forEach(categories, function(category) {                    var formattedCategory = {                        id: newsCtrl.news.data.categoryItemCount,                        name: category.name,                        value: category.name                    }                    newsCtrl.news.data.categoryItems.push(formattedCategory);                    newsCtrl.news.data.categoryItemCount++;                });            },            loadAllUnionNews: function () {                newsCtrl.news.ajax.getUnionAllNews({},function(success){                    newsCtrl.news.data.items = success.data.data.items;                    newsCtrl.news.data.paged = success.data.data.paged;                    newsCtrl.news.data.per_page = success.data.data.per_page;                    newsCtrl.news.data.totalItems = success.data.data.total;                }, function(error){                    GlobalLoaderService.show("Unable to get Union news.","danger").hide();                });            }        }    };    newsCtrl.news.init();}]);SCM_BLUEPRINT_NEWS_MODULE.controller('ModalInstanceCtrl', ['$uibModalInstance','news','GlobalLoaderService',function ($uibModalInstance,news,GlobalLoaderService) {    var newsCtrl = this;    newsCtrl.news = news;    newsCtrl.buttons = {        cancel: function () {            $uibModalInstance.dismiss('cancel');        }    };}]);